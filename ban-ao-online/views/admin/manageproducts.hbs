{{>adminTopMenu}}
<section id="qhuy-main-content">
	<div class="qhuy-container">
		<div class="ds-giao-dich" style="width: 90%;margin-left: auto; margin-right: auto;">
			<h2 style="color: black; margin-left: 15px;">Danh sách sản phẩm:</h2>
			<div style="float:right;height:50px; width: 100%; background:#DBECF6;">
				<form action="/admin/manageproduct/searchbyname"  style="float:right; margin-right: 18px;margin-top: 5px">
					<input class="form-control" placeholder="Tìm kiếm" name="input-search" id="txt_global_search" value="" type="text" style="padding: 3px 0;">
					<input type="submit" id="btn-search" value="search" style="width: 70px;">
					</input>
				</form>

				<!--<button id="admin-mng-product-btn-loc" style="color: black ;float: right; height: 35px; margin-right: 30px; margin-top: 2px">
					Lọc
				</button>-->
				<form action="/admin/manageproducts/filterbyprice" name="pricepicker" method="POST" style="height: 40px; width: 190px; float: right; margin-right: 10px; ">
					<select name="myselect" onchange="this.form.submit()">
                        <option value="0" >Tất cả</option>
						<option value="100" {{#if tempobj.is0}}selected{{/if}}>Dưới 100.000vnd</option>
						<option value="101" {{#if tempobj.is1}}selected{{/if}}>100.000-150.000vnd</option>
						<option value="151" {{#if tempobj.is2}}selected{{/if}}>150.000-200.000vnd</option>
						<option value="201" {{#if tempobj.is3}}selected{{/if}}>Trên 200.000vnd</option>
					</select>
                    <input class="filter-csrfToken" type="hidden" name="_csrf" value="{{csrfToken}}">
				</form>
				
				<button id="admin-mng-product-sort-btn" style="float: right; height: 25px; margin-right: 30px; margin-top: 5px;">
					<a style="color: black;" href="/admin/manageproducts/changeSortType"> Sắp xếp theo Mã SP</a>
				</button>
			</div>
			<div id="chi-tiet-gd">
				<table cellpadding="0" cellspacing="0" style="text-align: center;">
					<tbody>
						<tr>
							<th>Hình ảnh</th>
							<th>Mã sản phẩm</th>
							<th>Tên sản phẩm</th>
							<th>Loại sản phẩm</th>
							<th>Mô tả</th>
							<th>Giá</th>
							<th>Chỉnh sửa</th>
						</tr>
						{{#each products}}
						<tr>
							<td>
								<img src="{{this.pathToImg}}" alt="" style="width: 100px;">
							</td>
							<td>{{this.productID}}</td>
							<td>{{this.productName}}</td>
							<td>{{this.productStyle}}</td>
							<td>{{this.productDescription}}</td>
							<td>{{this.productPrice}}</td>
							<td>
								<button class="btn-quan-li-sua" style="
                                    background-color: #4CAF50;
                                    box-sizing: border-box;
                                    width: 40%;
                                    " onclick="editProduct({{this.productID}})">Sửa</button>
								<button class="btn-quan-li-xoa" style="
                                    background-color: red;
                                    box-sizing: border-box;
                                    width: 40%;
                                    " onclick="removeProduct({{this.productID}})">Xóa</button>
							</td>
						</tr>
						{{/each}}
					</tbody>
				</table>
			</div>
			<div class="button-luu-thay-doi">
				<button type="button" id="button-cart" class="btn btn-primary btn-lg btn-block"
				style="float:right; background: #45A049; padding: 5px;
						margin: 10px 18px 40px 0px; font-weight:bold;
						width: 150px; color:white;" 
                        onclick="addProduct()">
                    Thêm sản phẩm
				</button>
		</div>
	</div>
	</div>
</section>


<script>
function addProduct() {
    $('#qhuy-insert-product').css('display', 'block');
    $.get('/admin/insertproduct', function(data, status) {
        console.log(data);
        for (let i = 0; i < data.styles.length; ++i) {
            let selection = "<option value=\"" + data.styles[i].styleID + "\">" + data.styles[i].styleName + "</option>";
            $('#qhuy-insert-product select#productStyle').append(selection);
        }
        
        $('#qhuy-insert-product form input.insert-csrfToken').val(data.csrfToken);
        $('#qhuy-insert-product').css('display', 'block');
    });
}

function removeProduct(productid) {
    $.get('/admin/deleteproduct/'+productid, function(data, status) {
        window.location.replace('/admin/manageproducts');
    });
}

function editProduct(productid) {
    $.get('/admin/editproduct/'+productid, function(data, status) {
        $('#qhuy-edit-product form input.csrfToken').val(data.csrfToken);
        $('#qhuy-edit-product form').attr('action', '/admin/editproduct/' + data.productID);
        $('#qhuy-edit-product form input#productName').val(data.productName);
        $('#qhuy-edit-product form input#productDesp').val(data.productDesp);
        $('#qhuy-edit-product').css('display', 'block');
    });
}
</script>

{{>editProductForm}}
{{>addProductForm}}
